#!/bin/bash
# ABOUTME: Pre-commit hook to prevent AI-generated commit messages
# ABOUTME: Blocks commits with Claude/AI signatures to enforce clean commit messages

# Check for AI-generated commit signatures in the commit message
check_commit_message() {
    local commit_msg_file=".git/COMMIT_EDITMSG"

    if [ -f "$commit_msg_file" ]; then
        # Pattern matching for common AI commit signatures
        if grep -qE "ü§ñ|Generated with \[Claude|Co-Authored-By: Claude|Generated by AI|AI-assisted|Created with Claude|Generated with Claude Code" "$commit_msg_file"; then
            echo "‚ùå ERROR: AI-generated commit message detected!"
            echo ""
            echo "Found AI signature in commit message. Please write a proper commit message without:"
            echo "  - ü§ñ emoji"
            echo "  - 'Generated with [Claude Code]' or similar"
            echo "  - 'Co-Authored-By: Claude' or other AI attribution"
            echo ""
            echo "Your commit has been blocked. Please amend with a clean commit message."
            return 1
        fi
    fi
    return 0
}

# Main execution
main() {
    # Check commit message for AI signatures
    if ! check_commit_message; then
        exit 1
    fi

    echo "‚úÖ Commit message check passed"
    exit 0
}

main "$@"
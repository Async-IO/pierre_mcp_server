   Compiling pierre_mcp_server v0.1.0 (/Users/jeanfrancoisarcand/workspace/strava_ai/pierre_mcp_server)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 21.13s
     Running `target/debug/pierre-mcp-server`
[2m2025-08-14T19:59:48.245903Z[0m [32m INFO[0m [2mpierre_mcp_server::logging[0m[2m:[0m Pierre MCP Server starting up [3mservice.name[0m[2m=[0mpierre-mcp-server [3mservice.version[0m[2m=[0m0.1.0 [3menvironment[0m[2m=[0mdevelopment  
[2m2025-08-14T19:59:48.246356Z[0m [32m INFO[0m [2mpierre_mcp_server::logging[0m[2m:[0m Configuration loaded: {"logging":{"features":{"location":false,"spans":false,"thread":false},"format":"Pretty","level":"debug"},"service":{"environment":"development","name":"pierre-mcp-server","version":"0.1.0"}}
[2m2025-08-14T19:59:48.246535Z[0m [32m INFO[0m [2mpierre_mcp_server[0m[2m:[0m Starting Pierre Fitness API - Production Mode
[2m2025-08-14T19:59:48.246683Z[0m [32m INFO[0m [2mpierre_mcp_server[0m[2m:[0m Pierre MCP Server Configuration:
- MCP Port: 8080
- HTTP Port: 8081
- Log Level: debug
- Database: SQLite
- Strava OAuth: API-Configured
- Fitbit OAuth: API-Configured
- Weather Service: Disabled
- TLS: Disabled
- Rate Limiting: Enabled
- CI Mode: false
- Protocol Version: 2024-11-05
[2m2025-08-14T19:59:48.247166Z[0m [32m INFO[0m [2mpierre_mcp_server[0m[2m:[0m Encryption key loaded from: ./data/encryption.key
[2m2025-08-14T19:59:48.247511Z[0m [32m INFO[0m [2mpierre_mcp_server[0m[2m:[0m JWT secret loaded from: ./data/jwt.secret
[2m2025-08-14T19:59:48.247722Z[0m [34mDEBUG[0m [2mpierre_mcp_server::database_plugins::factory[0m[2m:[0m Detecting database type from URL: sqlite:./data/users.db
[2m2025-08-14T19:59:48.247802Z[0m [32m INFO[0m [2mpierre_mcp_server::database_plugins::factory[0m[2m:[0m Detected database type: SQLite
[2m2025-08-14T19:59:48.247914Z[0m [32m INFO[0m [2mpierre_mcp_server::database_plugins::factory[0m[2m:[0m Initializing SQLite database
[2m2025-08-14T19:59:48.252661Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"PRAGMA foreign_keys = ON; â€¦" [3mdb.statement[0m[2m=[0m"\n\nPRAGMA foreign_keys = ON; \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m483.666Âµs [3melapsed_secs[0m[2m=[0m0.000483666
[2m2025-08-14T19:59:48.259058Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS users (\n                id TEXT PRIMARY KEY,\n                email TEXT UNIQUE NOT NULL,\n                display_name TEXT,\n                password_hash TEXT NOT NULL,\n                tier TEXT NOT NULL DEFAULT 'starter' CHECK (tier IN ('starter', 'professional', 'enterprise')),\n                tenant_id TEXT,\n                strava_access_token TEXT,\n                strava_refresh_token TEXT,\n                strava_expires_at INTEGER,\n                strava_scope TEXT,\n                strava_nonce TEXT,\n                strava_last_sync DATETIME,\n                fitbit_access_token TEXT,\n                fitbit_refresh_token TEXT,\n                fitbit_expires_at INTEGER,\n                fitbit_scope TEXT,\n                fitbit_nonce TEXT,\n                fitbit_last_sync DATETIME,\n                is_active BOOLEAN NOT NULL DEFAULT 1,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                last_active DATETIME DEFAULT CURRENT_TIMESTAMP\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m4.8735ms [3melapsed_secs[0m[2m=[0m0.0048735
[2m2025-08-14T19:59:48.259688Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"PRAGMA foreign_keys = ON; â€¦" [3mdb.statement[0m[2m=[0m"\n\nPRAGMA foreign_keys = ON; \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m17.917Âµs [3melapsed_secs[0m[2m=[0m1.7917e-5
[2m2025-08-14T19:59:48.260556Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS user_profiles (\n                user_id TEXT PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,\n                profile_data TEXT NOT NULL,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m790.833Âµs [3melapsed_secs[0m[2m=[0m0.000790833
[2m2025-08-14T19:59:48.260732Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_users_email ON users(email)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m22.792Âµs [3melapsed_secs[0m[2m=[0m2.2792e-5
[2m2025-08-14T19:59:48.260840Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_users_is_active ON users(is_active)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m17.708Âµs [3melapsed_secs[0m[2m=[0m1.7708e-5
[2m2025-08-14T19:59:48.261139Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS api_keys (\n                id TEXT PRIMARY KEY,\n                user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n                name TEXT NOT NULL,\n                description TEXT,\n                key_hash TEXT NOT NULL,\n                key_prefix TEXT NOT NULL,\n                tier TEXT NOT NULL CHECK (tier IN ('trial', 'starter', 'professional', 'enterprise')),\n                rate_limit_requests INTEGER,\n                rate_limit_window_seconds INTEGER,\n                is_active BOOLEAN NOT NULL DEFAULT 1,\n                expires_at DATETIME,\n                last_used_at DATETIME,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                UNIQUE(key_hash),\n                UNIQUE(key_prefix)\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m31.625Âµs [3melapsed_secs[0m[2m=[0m3.1625e-5
[2m2025-08-14T19:59:48.261273Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS api_key_usage (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                api_key_id TEXT NOT NULL REFERENCES api_keys(id) ON DELETE CASCADE,\n                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n                tool_name TEXT NOT NULL,\n                status_code INTEGER NOT NULL,\n                response_time_ms INTEGER,\n                error_message TEXT,\n                request_size_bytes INTEGER,\n                response_size_bytes INTEGER,\n                ip_address TEXT,\n                user_agent TEXT\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m21.5Âµs [3melapsed_secs[0m[2m=[0m2.15e-5
[2m2025-08-14T19:59:48.261379Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_api_keys_user_id ON api_keys(user_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m19.125Âµs [3melapsed_secs[0m[2m=[0m1.9125e-5
[2m2025-08-14T19:59:48.261533Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_api_keys_key_prefix ON api_keys(key_prefix)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m15.458Âµs [3melapsed_secs[0m[2m=[0m1.5458e-5
[2m2025-08-14T19:59:48.261616Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_api_key_usage_key_id ON api_key_usage(api_key_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.959Âµs [3melapsed_secs[0m[2m=[0m1.4959e-5
[2m2025-08-14T19:59:48.261691Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_api_key_usage_timestamp ON api_key_usage(timestamp)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m15.875Âµs [3melapsed_secs[0m[2m=[0m1.5875e-5
[2m2025-08-14T19:59:48.261912Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS jwt_usage (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n                endpoint TEXT NOT NULL,\n                method TEXT NOT NULL,\n                status_code INTEGER NOT NULL,\n                response_time_ms INTEGER,\n                request_size_bytes INTEGER,\n                response_size_bytes INTEGER,\n                ip_address TEXT,\n                user_agent TEXT\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m21.75Âµs [3melapsed_secs[0m[2m=[0m2.175e-5
[2m2025-08-14T19:59:48.262014Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS goals (\n                id TEXT PRIMARY KEY,\n                user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n                goal_data TEXT NOT NULL,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m17.5Âµs [3melapsed_secs[0m[2m=[0m1.75e-5
[2m2025-08-14T19:59:48.262293Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS insights (\n                id TEXT PRIMARY KEY,\n                user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n                activity_id TEXT,\n                insight_type TEXT NOT NULL,\n                insight_data TEXT NOT NULL,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m20.125Âµs [3melapsed_secs[0m[2m=[0m2.0125e-5
[2m2025-08-14T19:59:48.262384Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS request_logs (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id TEXT REFERENCES users(id) ON DELETE CASCADE,\n                api_key_id TEXT REFERENCES api_keys(id) ON DELETE CASCADE,\n                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n                method TEXT NOT NULL,\n                endpoint TEXT NOT NULL,\n                status_code INTEGER NOT NULL,\n                response_time_ms INTEGER,\n                error_message TEXT\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m21.042Âµs [3melapsed_secs[0m[2m=[0m2.1042e-5
[2m2025-08-14T19:59:48.262474Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_jwt_usage_user_id ON jwt_usage(user_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.75Âµs [3melapsed_secs[0m[2m=[0m1.475e-5
[2m2025-08-14T19:59:48.262564Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_jwt_usage_timestamp ON jwt_usage(timestamp)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.416Âµs [3melapsed_secs[0m[2m=[0m1.4416e-5
[2m2025-08-14T19:59:48.262644Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_goals_user_id ON goals(user_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m15.083Âµs [3melapsed_secs[0m[2m=[0m1.5083e-5
[2m2025-08-14T19:59:48.262718Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_insights_user_id ON insights(user_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.041Âµs [3melapsed_secs[0m[2m=[0m1.4041e-5
[2m2025-08-14T19:59:48.262789Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_insights_activity_id ON insights(activity_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m13.792Âµs [3melapsed_secs[0m[2m=[0m1.3792e-5
[2m2025-08-14T19:59:48.262881Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_request_logs_timestamp ON request_logs(timestamp)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m13.583Âµs [3melapsed_secs[0m[2m=[0m1.3583e-5
[2m2025-08-14T19:59:48.263364Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS a2a_clients (\n                id TEXT PRIMARY KEY,\n                user_id TEXT NOT NULL,\n                name TEXT NOT NULL,\n                description TEXT,\n                public_key TEXT NOT NULL,\n                client_secret TEXT NOT NULL,\n                permissions TEXT NOT NULL,\n                capabilities TEXT NOT NULL DEFAULT '[]',\n                redirect_uris TEXT NOT NULL DEFAULT '[]',\n                rate_limit_requests INTEGER NOT NULL DEFAULT 1000,\n                rate_limit_window_seconds INTEGER NOT NULL DEFAULT 3600,\n                is_active BOOLEAN NOT NULL DEFAULT 1,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                UNIQUE(public_key)\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m23Âµs [3melapsed_secs[0m[2m=[0m2.3e-5
[2m2025-08-14T19:59:48.263646Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"ALTER TABLE a2a_clients ADD â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            ALTER TABLE a2a_clients ADD COLUMN capabilities TEXT DEFAULT '[]'\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m59.625Âµs [3melapsed_secs[0m[2m=[0m5.9625e-5
[2m2025-08-14T19:59:48.263750Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"ALTER TABLE a2a_clients ADD â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            ALTER TABLE a2a_clients ADD COLUMN redirect_uris TEXT DEFAULT '[]'\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m12.542Âµs [3melapsed_secs[0m[2m=[0m1.2542e-5
[2m2025-08-14T19:59:48.263988Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS a2a_sessions (\n                session_token TEXT PRIMARY KEY,\n                client_id TEXT NOT NULL REFERENCES a2a_clients(id) ON DELETE CASCADE,\n                user_id TEXT REFERENCES users(id) ON DELETE CASCADE,\n                granted_scopes TEXT NOT NULL,\n                expires_at DATETIME NOT NULL,\n                last_activity DATETIME DEFAULT CURRENT_TIMESTAMP,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                requests_count INTEGER NOT NULL DEFAULT 0\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m33Âµs [3melapsed_secs[0m[2m=[0m3.3e-5
[2m2025-08-14T19:59:48.264233Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS a2a_tasks (\n                id TEXT PRIMARY KEY,\n                client_id TEXT NOT NULL REFERENCES a2a_clients(id) ON DELETE CASCADE,\n                task_type TEXT NOT NULL,\n                input_data TEXT NOT NULL,\n                output_data TEXT,\n                status TEXT NOT NULL CHECK (status IN ('pending', 'running', 'completed', 'failed', 'cancelled')),\n                error_message TEXT,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                completed_at DATETIME\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m29Âµs [3melapsed_secs[0m[2m=[0m2.9e-5
[2m2025-08-14T19:59:48.264444Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS a2a_usage (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                client_id TEXT NOT NULL REFERENCES a2a_clients(id) ON DELETE CASCADE,\n                session_token TEXT REFERENCES a2a_sessions(session_token) ON DELETE SET NULL,\n                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n                tool_name TEXT NOT NULL,\n                response_time_ms INTEGER,\n                status_code INTEGER NOT NULL,\n                error_message TEXT,\n                request_size_bytes INTEGER,\n                response_size_bytes INTEGER,\n                ip_address TEXT,\n                user_agent TEXT,\n                protocol_version TEXT NOT NULL DEFAULT '1.0',\n                client_capabilities TEXT NOT NULL DEFAULT '[]',\n                granted_scopes TEXT NOT NULL DEFAULT '[]'\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m27.084Âµs [3melapsed_secs[0m[2m=[0m2.7084e-5
[2m2025-08-14T19:59:48.264611Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS a2a_client_api_keys (\n                client_id TEXT NOT NULL REFERENCES a2a_clients(id) ON DELETE CASCADE,\n                api_key_id TEXT NOT NULL REFERENCES api_keys(id) ON DELETE CASCADE,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                PRIMARY KEY (client_id, api_key_id)\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m20.416Âµs [3melapsed_secs[0m[2m=[0m2.0416e-5
[2m2025-08-14T19:59:48.264930Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_a2a_sessions_client_id ON a2a_sessions(client_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m17.209Âµs [3melapsed_secs[0m[2m=[0m1.7209e-5
[2m2025-08-14T19:59:48.265120Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_a2a_sessions_expires_at ON a2a_sessions(expires_at)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m15Âµs [3melapsed_secs[0m[2m=[0m1.5e-5
[2m2025-08-14T19:59:48.265286Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_a2a_tasks_client_id ON a2a_tasks(client_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.875Âµs [3melapsed_secs[0m[2m=[0m1.4875e-5
[2m2025-08-14T19:59:48.265409Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_a2a_tasks_status ON a2a_tasks(status)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m16.167Âµs [3melapsed_secs[0m[2m=[0m1.6167e-5
[2m2025-08-14T19:59:48.265506Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_a2a_usage_client_id ON a2a_usage(client_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.25Âµs [3melapsed_secs[0m[2m=[0m1.425e-5
[2m2025-08-14T19:59:48.265604Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_a2a_usage_timestamp ON a2a_usage(timestamp)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.167Âµs [3melapsed_secs[0m[2m=[0m1.4167e-5
[2m2025-08-14T19:59:48.265812Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS admin_tokens (\n                id TEXT PRIMARY KEY,\n                service_name TEXT NOT NULL,\n                service_description TEXT,\n                token_hash TEXT NOT NULL,\n                token_prefix TEXT NOT NULL,\n                jwt_secret_hash TEXT NOT NULL,\n                permissions TEXT NOT NULL DEFAULT '[\"provision_keys\"]',\n                is_super_admin BOOLEAN NOT NULL DEFAULT false,\n                is_active BOOLEAN NOT NULL DEFAULT true,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                expires_at DATETIME,\n                last_used_at DATETIME,\n                last_used_ip TEXT,\n                usage_count INTEGER NOT NULL DEFAULT 0\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m22.666Âµs [3melapsed_secs[0m[2m=[0m2.2666e-5
[2m2025-08-14T19:59:48.265965Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS admin_token_usage (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                admin_token_id TEXT NOT NULL REFERENCES admin_tokens(id) ON DELETE CASCADE,\n                timestamp DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n                action TEXT NOT NULL,\n                target_resource TEXT,\n                ip_address TEXT,\n                user_agent TEXT,\n                request_size_bytes INTEGER,\n                success BOOLEAN NOT NULL,\n                error_message TEXT,\n                response_time_ms INTEGER\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m19.833Âµs [3melapsed_secs[0m[2m=[0m1.9833e-5
[2m2025-08-14T19:59:48.266178Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS admin_provisioned_keys (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                admin_token_id TEXT NOT NULL REFERENCES admin_tokens(id) ON DELETE CASCADE,\n                api_key_id TEXT NOT NULL,\n                user_email TEXT NOT NULL,\n                requested_tier TEXT NOT NULL,\n                provisioned_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n                provisioned_by_service TEXT NOT NULL,\n                rate_limit_requests INTEGER NOT NULL,\n                rate_limit_period TEXT NOT NULL,\n                key_status TEXT NOT NULL DEFAULT 'active',\n                revoked_at DATETIME,\n                revoked_reason TEXT\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m20.917Âµs [3melapsed_secs[0m[2m=[0m2.0917e-5
[2m2025-08-14T19:59:48.266261Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_admin_tokens_service ON admin_tokens(service_name)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.667Âµs [3melapsed_secs[0m[2m=[0m1.4667e-5
[2m2025-08-14T19:59:48.266336Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_admin_tokens_prefix ON admin_tokens(token_prefix)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m15.667Âµs [3melapsed_secs[0m[2m=[0m1.5667e-5
[2m2025-08-14T19:59:48.266410Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_admin_usage_token_id ON admin_token_usage(admin_token_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.5Âµs [3melapsed_secs[0m[2m=[0m1.45e-5
[2m2025-08-14T19:59:48.266484Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_admin_usage_timestamp ON admin_token_usage(timestamp)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m13.834Âµs [3melapsed_secs[0m[2m=[0m1.3834e-5
[2m2025-08-14T19:59:48.266558Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_admin_provisioned_token ON admin_provisioned_keys(admin_token_id)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.625Âµs [3melapsed_secs[0m[2m=[0m1.4625e-5
[2m2025-08-14T19:59:48.268041Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS tenants ( id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), name TEXT NOT NULL, slug TEXT UNIQUE NOT NULL, domain TEXT, plan TEXT NOT NULL DEFAULT 'starter' CHECK (plan IN ('starter', 'professional', 'enterprise')), owner_user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE, is_active BOOLEAN NOT NULL DEFAULT true, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, UNIQUE(owner_user_id, name) );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m33.208Âµs [3melapsed_secs[0m[2m=[0m3.3208e-5
[2m2025-08-14T19:59:48.268100Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenants_slug ON tenants(slug);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m10.542Âµs [3melapsed_secs[0m[2m=[0m1.0542e-5
[2m2025-08-14T19:59:48.268141Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenants_owner ON tenants(owner_user_id);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8Âµs [3melapsed_secs[0m[2m=[0m8e-6
[2m2025-08-14T19:59:48.268184Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenants_active ON tenants(is_active);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m7.75Âµs [3melapsed_secs[0m[2m=[0m7.75e-6
[2m2025-08-14T19:59:48.268241Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS tenant_oauth_credentials ( id INTEGER PRIMARY KEY AUTOINCREMENT, tenant_id TEXT NOT NULL REFERENCES tenants(id) ON DELETE CASCADE, provider TEXT NOT NULL, client_id TEXT NOT NULL, client_secret_encrypted TEXT NOT NULL, redirect_uri TEXT NOT NULL, scopes TEXT NOT NULL, rate_limit_per_day INTEGER NOT NULL DEFAULT 15000, is_active BOOLEAN NOT NULL DEFAULT true, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, UNIQUE(tenant_id, provider) );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m18.042Âµs [3melapsed_secs[0m[2m=[0m1.8042e-5
[2m2025-08-14T19:59:48.268280Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_oauth_tenant_id ON tenant_oauth_credentials(tenant_id);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.167Âµs [3melapsed_secs[0m[2m=[0m8.167e-6
[2m2025-08-14T19:59:48.268318Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_oauth_provider ON tenant_oauth_credentials(provider);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m7.708Âµs [3melapsed_secs[0m[2m=[0m7.708e-6
[2m2025-08-14T19:59:48.268357Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_oauth_active ON tenant_oauth_credentials(is_active);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.5Âµs [3melapsed_secs[0m[2m=[0m8.5e-6
[2m2025-08-14T19:59:48.268455Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS oauth_apps ( id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), client_id TEXT UNIQUE NOT NULL, client_secret_hash TEXT NOT NULL, name TEXT NOT NULL, description TEXT, redirect_uris TEXT NOT NULL, scopes TEXT NOT NULL, app_type TEXT NOT NULL DEFAULT 'confidential' CHECK (app_type IN ('public', 'confidential')), owner_user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE, is_active BOOLEAN NOT NULL DEFAULT true, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, UNIQUE(owner_user_id, name) );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m20.709Âµs [3melapsed_secs[0m[2m=[0m2.0709e-5
[2m2025-08-14T19:59:48.268494Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_oauth_apps_client_id ON oauth_apps(client_id);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m7.459Âµs [3melapsed_secs[0m[2m=[0m7.459e-6
[2m2025-08-14T19:59:48.268531Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_oauth_apps_owner ON oauth_apps(owner_user_id);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m7.625Âµs [3melapsed_secs[0m[2m=[0m7.625e-6
[2m2025-08-14T19:59:48.268588Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_oauth_apps_active ON oauth_apps(is_active);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m9.833Âµs [3melapsed_secs[0m[2m=[0m9.833e-6
[2m2025-08-14T19:59:48.268650Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS authorization_codes ( code TEXT PRIMARY KEY, client_id TEXT NOT NULL REFERENCES oauth_apps(client_id) ON DELETE CASCADE, redirect_uri TEXT NOT NULL, scope TEXT NOT NULL, user_id TEXT REFERENCES users(id) ON DELETE CASCADE, expires_at TIMESTAMP NOT NULL, is_used BOOLEAN NOT NULL DEFAULT false, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, used_at TIMESTAMP );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m13.375Âµs [3melapsed_secs[0m[2m=[0m1.3375e-5
[2m2025-08-14T19:59:48.268703Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_auth_codes_client_id ON authorization_codes(client_id);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m9.959Âµs [3melapsed_secs[0m[2m=[0m9.959e-6
[2m2025-08-14T19:59:48.268753Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_auth_codes_expires_at ON authorization_codes(expires_at);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m10.584Âµs [3melapsed_secs[0m[2m=[0m1.0584e-5
[2m2025-08-14T19:59:48.268802Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_auth_codes_used ON authorization_codes(is_used);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m10.875Âµs [3melapsed_secs[0m[2m=[0m1.0875e-5
[2m2025-08-14T19:59:48.268873Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS oauth_access_tokens ( id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), token_hash TEXT UNIQUE NOT NULL, client_id TEXT NOT NULL REFERENCES oauth_apps(client_id) ON DELETE CASCADE, user_id TEXT REFERENCES users(id) ON DELETE CASCADE, scope TEXT NOT NULL, token_type TEXT NOT NULL DEFAULT 'bearer', expires_at TIMESTAMP, last_used_at TIMESTAMP, usage_count INTEGER NOT NULL DEFAULT 0, is_active BOOLEAN NOT NULL DEFAULT true, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m20.25Âµs [3melapsed_secs[0m[2m=[0m2.025e-5
[2m2025-08-14T19:59:48.268927Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_oauth_tokens_hash ON oauth_access_tokens(token_hash);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m10.625Âµs [3melapsed_secs[0m[2m=[0m1.0625e-5
[2m2025-08-14T19:59:48.268979Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_oauth_tokens_client ON oauth_access_tokens(client_id);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m9.167Âµs [3melapsed_secs[0m[2m=[0m9.167e-6
[2m2025-08-14T19:59:48.269029Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_oauth_tokens_expires ON oauth_access_tokens(expires_at);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m10.042Âµs [3melapsed_secs[0m[2m=[0m1.0042e-5
[2m2025-08-14T19:59:48.269085Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_oauth_tokens_active ON oauth_access_tokens(is_active);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m9.125Âµs [3melapsed_secs[0m[2m=[0m9.125e-6
[2m2025-08-14T19:59:48.269147Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS tenant_usage ( id INTEGER PRIMARY KEY AUTOINCREMENT, tenant_id TEXT NOT NULL REFERENCES tenants(id) ON DELETE CASCADE, provider TEXT NOT NULL, endpoint TEXT NOT NULL, method TEXT NOT NULL, status_code INTEGER NOT NULL, response_time_ms INTEGER, error_message TEXT, timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m14.667Âµs [3melapsed_secs[0m[2m=[0m1.4667e-5
[2m2025-08-14T19:59:48.269219Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS tenant_usage_stats ( tenant_id TEXT NOT NULL REFERENCES tenants(id) ON DELETE CASCADE, provider TEXT NOT NULL, period_start TIMESTAMP NOT NULL, period_end TIMESTAMP NOT NULL, total_requests INTEGER NOT NULL DEFAULT 0, successful_requests INTEGER NOT NULL DEFAULT 0, failed_requests INTEGER NOT NULL DEFAULT 0, total_response_time_ms INTEGER NOT NULL DEFAULT 0, daily_limit INTEGER NOT NULL, current_usage INTEGER NOT NULL DEFAULT 0, PRIMARY KEY (tenant_id, provider, period_start) );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m20Âµs [3melapsed_secs[0m[2m=[0m2e-5
[2m2025-08-14T19:59:48.269270Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_usage_tenant_id ON tenant_usage(tenant_id);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m10.5Âµs [3melapsed_secs[0m[2m=[0m1.05e-5
[2m2025-08-14T19:59:48.269317Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_usage_timestamp ON tenant_usage(timestamp);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m9.083Âµs [3melapsed_secs[0m[2m=[0m9.083e-6
[2m2025-08-14T19:59:48.269363Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_usage_provider ON tenant_usage(provider);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.833Âµs [3melapsed_secs[0m[2m=[0m8.833e-6
[2m2025-08-14T19:59:48.269412Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_stats_period ON tenant_usage_stats(period_start, period_end);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m10.166Âµs [3melapsed_secs[0m[2m=[0m1.0166e-5
[2m2025-08-14T19:59:48.270101Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"DROP TRIGGER IF EXISTS â€¦" [3mdb.statement[0m[2m=[0m"\n\nDROP TRIGGER IF EXISTS update_tenants_timestamp;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m648.541Âµs [3melapsed_secs[0m[2m=[0m0.000648541
[2m2025-08-14T19:59:48.270756Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TRIGGER update_tenants_timestamp AFTER â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TRIGGER update_tenants_timestamp AFTER UPDATE ON tenants BEGIN UPDATE tenants SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id; END;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m602.167Âµs [3melapsed_secs[0m[2m=[0m0.000602167
[2m2025-08-14T19:59:48.270842Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"DROP TRIGGER IF EXISTS â€¦" [3mdb.statement[0m[2m=[0m"\n\nDROP TRIGGER IF EXISTS update_tenant_oauth_timestamp;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m41.833Âµs [3melapsed_secs[0m[2m=[0m4.1833e-5
[2m2025-08-14T19:59:48.270959Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TRIGGER update_tenant_oauth_timestamp AFTER â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TRIGGER update_tenant_oauth_timestamp AFTER UPDATE ON tenant_oauth_credentials BEGIN UPDATE tenant_oauth_credentials SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id; END;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m68.833Âµs [3melapsed_secs[0m[2m=[0m6.8833e-5
[2m2025-08-14T19:59:48.271042Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"DROP TRIGGER IF EXISTS â€¦" [3mdb.statement[0m[2m=[0m"\n\nDROP TRIGGER IF EXISTS update_oauth_apps_timestamp;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m38.375Âµs [3melapsed_secs[0m[2m=[0m3.8375e-5
[2m2025-08-14T19:59:48.271147Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TRIGGER update_oauth_apps_timestamp AFTER â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TRIGGER update_oauth_apps_timestamp AFTER UPDATE ON oauth_apps BEGIN UPDATE oauth_apps SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id; END;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m59.167Âµs [3melapsed_secs[0m[2m=[0m5.9167e-5
[2m2025-08-14T19:59:48.271228Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"DROP TRIGGER IF EXISTS â€¦" [3mdb.statement[0m[2m=[0m"\n\nDROP TRIGGER IF EXISTS update_oauth_tokens_timestamp;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m37.917Âµs [3melapsed_secs[0m[2m=[0m3.7917e-5
[2m2025-08-14T19:59:48.271334Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TRIGGER update_oauth_tokens_timestamp AFTER â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TRIGGER update_oauth_tokens_timestamp AFTER UPDATE ON oauth_access_tokens BEGIN UPDATE oauth_access_tokens SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id; END;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m57.5Âµs [3melapsed_secs[0m[2m=[0m5.75e-5
[2m2025-08-14T19:59:48.271415Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"DROP TRIGGER IF EXISTS â€¦" [3mdb.statement[0m[2m=[0m"\n\nDROP TRIGGER IF EXISTS cleanup_expired_auth_codes;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m36.958Âµs [3melapsed_secs[0m[2m=[0m3.6958e-5
[2m2025-08-14T19:59:48.271589Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TRIGGER cleanup_expired_auth_codes AFTER â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TRIGGER cleanup_expired_auth_codes AFTER INSERT ON authorization_codes BEGIN DELETE FROM authorization_codes WHERE expires_at < CURRENT_TIMESTAMP AND is_used = false; END;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m52.125Âµs [3melapsed_secs[0m[2m=[0m5.2125e-5
[2m2025-08-14T19:59:48.272363Z[0m [32m INFO[0m [2mpierre_mcp_server::database[0m[2m:[0m Tenant management tables migration completed successfully
[2m2025-08-14T19:59:48.273603Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS key_versions ( tenant_id TEXT, version INTEGER NOT NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, expires_at DATETIME NOT NULL, is_active BOOLEAN NOT NULL DEFAULT FALSE, algorithm TEXT NOT NULL DEFAULT 'AES-256-GCM', PRIMARY KEY (tenant_id, version) );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m806.958Âµs [3melapsed_secs[0m[2m=[0m0.000806958
[2m2025-08-14T19:59:48.273731Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_key_versions_tenant_active ON key_versions(tenant_id, is_active, version DESC);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m9.5Âµs [3melapsed_secs[0m[2m=[0m9.5e-6
[2m2025-08-14T19:59:48.273771Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_key_versions_expires_at ON key_versions(expires_at);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m7.834Âµs [3melapsed_secs[0m[2m=[0m7.834e-6
[2m2025-08-14T19:59:48.273818Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS audit_events ( id TEXT PRIMARY KEY, event_type TEXT NOT NULL, severity TEXT NOT NULL, message TEXT NOT NULL, source TEXT NOT NULL, result TEXT NOT NULL, tenant_id TEXT, user_id TEXT, ip_address TEXT, user_agent TEXT, metadata TEXT NOT NULL DEFAULT '{}', timestamp DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP );\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m12.792Âµs [3melapsed_secs[0m[2m=[0m1.2792e-5
[2m2025-08-14T19:59:48.273859Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_audit_events_timestamp ON audit_events(timestamp DESC);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.084Âµs [3melapsed_secs[0m[2m=[0m8.084e-6
[2m2025-08-14T19:59:48.273900Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_audit_events_tenant_timestamp ON audit_events(tenant_id, timestamp DESC);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.584Âµs [3melapsed_secs[0m[2m=[0m8.584e-6
[2m2025-08-14T19:59:48.273942Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_audit_events_user_timestamp ON audit_events(user_id, timestamp DESC);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.125Âµs [3melapsed_secs[0m[2m=[0m8.125e-6
[2m2025-08-14T19:59:48.274025Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_audit_events_type_timestamp ON audit_events(event_type, timestamp DESC);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m9.75Âµs [3melapsed_secs[0m[2m=[0m9.75e-6
[2m2025-08-14T19:59:48.274063Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_audit_events_severity ON audit_events(severity, timestamp DESC);\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.084Âµs [3melapsed_secs[0m[2m=[0m8.084e-6
[2m2025-08-14T19:59:48.275804Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"INSERT OR IGNORE INTO â€¦" [3mdb.statement[0m[2m=[0m"\n\nINSERT OR IGNORE INTO key_versions (tenant_id, version, created_at, expires_at, is_active, algorithm) VALUES (NULL, 1, CURRENT_TIMESTAMP, datetime('now', '+1 year'), true, 'AES-256-GCM');\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m1.707333ms [3melapsed_secs[0m[2m=[0m0.001707333
[2m2025-08-14T19:59:48.276077Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"INSERT OR IGNORE INTO â€¦" [3mdb.statement[0m[2m=[0m"\n\nINSERT OR IGNORE INTO audit_events ( id, event_type, severity, message, source, result, metadata, timestamp ) VALUES ( hex(randomblob(16)), 'SystemInitialized', 'Info', 'Key rotation and audit system initialized', 'security_migration', 'success', '{\"version\": \"1.0\", \"migration\": \"005_security\"}', CURRENT_TIMESTAMP );\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m229.041Âµs [3melapsed_secs[0m[2m=[0m0.000229041
[2m2025-08-14T19:59:48.276469Z[0m [32m INFO[0m [2mpierre_mcp_server::database[0m[2m:[0m Security tables migration completed successfully
[2m2025-08-14T19:59:48.276698Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\n\n            CREATE TABLE IF NOT EXISTS user_oauth_tokens (\n                id TEXT PRIMARY KEY,\n                user_id TEXT NOT NULL,\n                tenant_id TEXT NOT NULL,\n                provider TEXT NOT NULL,\n                access_token TEXT NOT NULL,\n                refresh_token TEXT,\n                token_type TEXT NOT NULL DEFAULT 'bearer',\n                expires_at DATETIME,\n                scope TEXT,\n                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n                UNIQUE(user_id, tenant_id, provider)\n            )\n            \n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m32.75Âµs [3melapsed_secs[0m[2m=[0m3.275e-5
[2m2025-08-14T19:59:48.276785Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_user_oauth_tokens_user ON user_oauth_tokens(user_id)\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m16.5Âµs [3melapsed_secs[0m[2m=[0m1.65e-5
[2m2025-08-14T19:59:48.276864Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_user_oauth_tokens_tenant_provider ON user_oauth_tokens(tenant_id, provider)\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m16.125Âµs [3melapsed_secs[0m[2m=[0m1.6125e-5
[2m2025-08-14T19:59:48.277229Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE TABLE IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE TABLE IF NOT EXISTS tenant_users ( id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), tenant_id TEXT NOT NULL REFERENCES tenants(id) ON DELETE CASCADE, user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE, role TEXT NOT NULL DEFAULT 'member' CHECK (role IN ('owner', 'admin', 'billing', 'member')), joined_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, UNIQUE(tenant_id, user_id) );\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m27.125Âµs [3melapsed_secs[0m[2m=[0m2.7125e-5
[2m2025-08-14T19:59:48.277324Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_users_tenant ON tenant_users(tenant_id);\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.167Âµs [3melapsed_secs[0m[2m=[0m8.167e-6
[2m2025-08-14T19:59:48.277363Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_users_user ON tenant_users(user_id);\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m7.667Âµs [3melapsed_secs[0m[2m=[0m7.667e-6
[2m2025-08-14T19:59:48.277405Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"CREATE INDEX IF NOT â€¦" [3mdb.statement[0m[2m=[0m"\n\nCREATE INDEX IF NOT EXISTS idx_tenant_users_role ON tenant_users(role);\n" [3mrows_affected[0m[2m=[0m1 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m8.166Âµs [3melapsed_secs[0m[2m=[0m8.166e-6
[2m2025-08-14T19:59:48.278506Z[0m [34mDEBUG[0m [2msqlx::query[0m[2m:[0m [3msummary[0m[2m=[0m"INSERT OR IGNORE INTO â€¦" [3mdb.statement[0m[2m=[0m"\n\nINSERT OR IGNORE INTO tenant_users (tenant_id, user_id, role, joined_at) SELECT u.tenant_id, u.id, 'member' as role, u.created_at as joined_at FROM users u WHERE u.tenant_id IS NOT NULL;\n" [3mrows_affected[0m[2m=[0m0 [3mrows_returned[0m[2m=[0m0 [3melapsed[0m[2m=[0m1.067875ms [3melapsed_secs[0m[2m=[0m0.001067875
Error: error returned from database: (code: 787) FOREIGN KEY constraint failed

Caused by:
    (code: 787) FOREIGN KEY constraint failed
